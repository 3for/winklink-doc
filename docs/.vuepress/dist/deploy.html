<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建 WINkLink 节点 | WINkLink 开发文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/v1/doc/favicon.ico">
    <meta name="description" content="WINkLink 开发和使用手册">
    
    <link rel="preload" href="/v1/doc/assets/css/0.styles.80b33373.css" as="style"><link rel="preload" href="/v1/doc/assets/js/app.2c857601.js" as="script"><link rel="preload" href="/v1/doc/assets/js/2.f2b16297.js" as="script"><link rel="preload" href="/v1/doc/assets/js/9.790d0f70.js" as="script"><link rel="prefetch" href="/v1/doc/assets/js/10.48fcf582.js"><link rel="prefetch" href="/v1/doc/assets/js/11.9452f0d4.js"><link rel="prefetch" href="/v1/doc/assets/js/12.ba475056.js"><link rel="prefetch" href="/v1/doc/assets/js/13.46041a7c.js"><link rel="prefetch" href="/v1/doc/assets/js/14.3bc4688f.js"><link rel="prefetch" href="/v1/doc/assets/js/15.ccb561fe.js"><link rel="prefetch" href="/v1/doc/assets/js/16.c5d3ca82.js"><link rel="prefetch" href="/v1/doc/assets/js/17.c9435c6d.js"><link rel="prefetch" href="/v1/doc/assets/js/18.12b1d2e4.js"><link rel="prefetch" href="/v1/doc/assets/js/19.b9b0cb89.js"><link rel="prefetch" href="/v1/doc/assets/js/20.c870f8f0.js"><link rel="prefetch" href="/v1/doc/assets/js/21.07f05b3d.js"><link rel="prefetch" href="/v1/doc/assets/js/22.fb119882.js"><link rel="prefetch" href="/v1/doc/assets/js/23.572dfe6f.js"><link rel="prefetch" href="/v1/doc/assets/js/3.0862f354.js"><link rel="prefetch" href="/v1/doc/assets/js/4.273ae178.js"><link rel="prefetch" href="/v1/doc/assets/js/5.71746619.js"><link rel="prefetch" href="/v1/doc/assets/js/6.f5b065ee.js"><link rel="prefetch" href="/v1/doc/assets/js/7.25d11dd2.js"><link rel="prefetch" href="/v1/doc/assets/js/8.add5fbc5.js">
    <link rel="stylesheet" href="/v1/doc/assets/css/0.styles.80b33373.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v1/doc/" class="home-link router-link-active"><!----> <span class="site-name">WINkLink 开发文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/deploy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/deploy.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/deploy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/deploy.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/v1/doc/" aria-current="page" class="sidebar-link">项目介绍</a></li><li><a href="/v1/doc/architecture.html" class="sidebar-link">系统架构设计</a></li><li><a href="/v1/doc/deploy.html" aria-current="page" class="active sidebar-link">搭建 WINkLink 节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#合约部署" class="sidebar-link">合约部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#winkmid-合约" class="sidebar-link">WinkMid 合约</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#oracle-合约" class="sidebar-link">Oracle 合约</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#节点部署" class="sidebar-link">节点部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#准备节点帐号" class="sidebar-link">准备节点帐号</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#依赖环境" class="sidebar-link">依赖环境</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#获取节点可执行程序" class="sidebar-link">获取节点可执行程序</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#节点配置" class="sidebar-link">节点配置</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#启动节点" class="sidebar-link">启动节点</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#为节点添加-job" class="sidebar-link">为节点添加 job</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#查询节点-job" class="sidebar-link">查询节点 job</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#为节点账户授权" class="sidebar-link">为节点账户授权</a></li><li class="sidebar-sub-header"><a href="/v1/doc/deploy.html#申请成为官方认证-winklink-节点" class="sidebar-link">申请成为官方认证 WINkLink 节点</a></li></ul></li><li><a href="/v1/doc/pricing.html" class="sidebar-link">WINkLink 价格服务</a></li><li><a href="/v1/doc/v2.html" class="sidebar-link">v2 FluxAggregator</a></li><li><a href="/v1/doc/proxy.html" class="sidebar-link">代理合约</a></li><li><a href="/v1/doc/glossary.html" class="sidebar-link">术语表</a></li><li><a href="/v1/doc/vrf.html" class="sidebar-link">WINkLink 随机数服务</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="搭建-winklink-节点"><a href="#搭建-winklink-节点" class="header-anchor">#</a> 搭建 WINkLink 节点</h1> <p>本节介绍如何加入 WINkLink 生态：部署预言机合约，搭建 WINkLink 节点。</p> <p>目前 WINkLink 不区分 Oracle 合约拥有者和预言机节点运营者。
即预言机节点的运营者同时是 Oracle 合约的拥有者。预言机节点账户只处理数据源和数据提交，
Oracle 合约拥有者可以通过合约调用，提取 Oracle 合约使用者所支付的使用费。</p> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <p>WINkLink 的维护者需要对 TRON 有一定的了解，熟悉智能合约部署和调用流程。
建议参考 <a href="https://cn.developers.tron.network/" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>主要阅读 TronIDE 合约部署相关内容。</p> <h2 id="合约部署"><a href="#合约部署" class="header-anchor">#</a> 合约部署</h2> <p>WINkLink 生态采用去中心化架构，所有智能合约开源，任何组织和个人都可以部署自己的 WINkLink 预言机合约，
并对外公布所提供的服务。</p> <p>用户可以从各个公开 WINkLink 服务中选择自己所需的组合，创建自己的聚合数据合约，从去中心化受益。</p> <p>项目合约地址位于: <a href="https://github.com/wink-link/winklink/tree/master/tvm-contracts/v1.0" target="_blank" rel="noopener noreferrer">https://github.com/wink-link/winklink/tree/master/tvm-contracts/v1.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>开发者需要使用 <a href="https://github.com/tronprotocol/solidity/releases/tag/0.4.25_Odyssey_v3.2.3" target="_blank" rel="noopener noreferrer">tron-solidity 0.4.25<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
编译器编译。(或在 TronIDE 中选择该版本)</p> <p>合约的部署和测试调用可以使用如下任一工具或程序库：</p> <ul><li><a href="https://github.com/tronprotocol/wallet-cli" target="_blank" rel="noopener noreferrer">官方 wallet-cli 工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/docs/ide%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">TronIDE, 同时支持合约编译<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/docs/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2" target="_blank" rel="noopener noreferrer">TronBox, 同时支持合约编译<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/reference#tronwebcontractnew" target="_blank" rel="noopener noreferrer">tronweb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tronpy.readthedocs.io/en/latest/contract.html#creating-smart-contract" target="_blank" rel="noopener noreferrer">tronpy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/andelf/rust-tron/blob/master/docs/contract.md" target="_blank" rel="noopener noreferrer">rust-tron<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="winkmid-合约"><a href="#winkmid-合约" class="header-anchor">#</a> WinkMid 合约</h3> <p>WINkLink 使用 WIN 代币(TRC20)作为整个生态的基础代币。</p> <p>WINkLink 依赖 <code>transferAndCall</code> 功能，即在转账 TRC20 代币给合约的同时调用合约的某一回调函数，相关功能类似 <a href="https://github.com/ethereum/EIPs/issues/677" target="_blank" rel="noopener noreferrer">ERC677<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 但接口参数不同。</p> <p>考虑到绝大多数已发行的代币无法再修改合约增加接口, WINkLink 提供了 <code>WinkMid</code> 合约，可以用来包装任一 TRC20 代币，并提供
<code>transferAndCall</code> 接口。</p> <p>合约代码位于 <a href="https://github.com/wink-link/winklink/blob/feature/rename2wink/tvm-contracts/v1.0/WinkMid.sol" target="_blank" rel="noopener noreferrer">WinkMid.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>为方便开发者, Nile 测试网已经部署了 <code>WinkMid</code> 合约，封装了 Nile 测试网 <code>WIN</code> 代币。
开发者可直接使用该合约地址，无需额外部署。 Nile 测试网同时提供了水龙头地址可以领取测试 TRX 和 WIN 代币。</p> <div class="custom-block tip"><p class="custom-block-title">Nile 测试网</p> <ul><li>WIN 代币合约地址: <code>TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7</code></li> <li>WinkMid 合约地址: <code>TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb</code></li> <li>测试网水龙头: <a href="https://nileex.io/join/getJoinPage" target="_blank" rel="noopener noreferrer">https://nileex.io/join/getJoinPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <p>部署 WinkMid 合约时候需要在构造函数提供被封装的 TRC20 代币地址（即 WIN 代币地址）。</p> <p>所有对 WinkMid 合约的操作均在合约中进行，开发者不需要直接调用该合约。</p> <h3 id="oracle-合约"><a href="#oracle-合约" class="header-anchor">#</a> Oracle 合约</h3> <p>Oracle 合约是部署在 TRON 公链上的预言机合约。主要功能如下</p> <ul><li>接收消费者合约(Consumer Contract)的数据请求，触发 Event Log
<ul><li>数据请求发送时会附带 WIN 转账作为使用费用</li></ul></li> <li>接受 WINkLink 节点所提交的数据
<ul><li>WINkLink 节点通过监听 Event Log 获知数据请求</li> <li>节点通过识别 job 配置，选择调用不同数据请求对应的适配器，获得外部数据，向 Oracle 合约提交数据</li> <li>触发消费者合约的数据回调函数</li></ul></li> <li>支持撤销数据请求</li> <li>对数据请求的 WIN 代币费用进行结算，提取收益</li></ul> <p>合约代码位于 <a href="https://github.com/wink-link/winklink/blob/master/tvm-contracts/v1.0/TronOracles.sol" target="_blank" rel="noopener noreferrer">TronOracles.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>部署 Oracle 合约时需要在构造函数提供 WIN 代币地址和 WinkMid 合约地址。</p> <p>Oracle 合约实现了 <code>Ownable</code> 接口，合约的 owner 可以管理收益或销毁合约。</p> <h2 id="节点部署"><a href="#节点部署" class="header-anchor">#</a> 节点部署</h2> <p>合约部署完毕后，就可以开始 WINkLink 节点部署。</p> <p>WINkLink 节点(项目目录 <code>node</code>)代码位于: <a href="https://github.com/wink-link/winklink/tree/master/node" target="_blank" rel="noopener noreferrer">https://github.com/wink-link/winklink/tree/master/node<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>目前的节点实现包含通过交易所 API 获取币价的适配器。请在稳定的非中国大陆网络环境中运行节点。</p></div> <h3 id="准备节点帐号"><a href="#准备节点帐号" class="header-anchor">#</a> 准备节点帐号</h3> <p>每个 WINkLink 节点都必须对应一个 TRON 帐号，用于调用 Oracle 合约提交数据。</p> <p>开发者生成帐号地址和私钥后，通过测试网水龙头页面投测试 TRX 代币。该代币用于支付智能合约调用的必要费用。</p> <p>开发者可以选用以下任一方法生成帐号地址和私钥：</p> <ul><li><a href="https://github.com/tronprotocol/wallet-cli" target="_blank" rel="noopener noreferrer">官方 wallet-cli 工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://andelf.gitbook.io/tron/tron-by-example/generate-address-offline" target="_blank" rel="noopener noreferrer">Generate Address Offline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/ki5fpl/tronj/blob/master/client/src/test/java/com/github/ki5fpl/tronj/client/ClientTest.java#L70" target="_blank" rel="noopener noreferrer">tronj<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/andelf/tronpy/blob/master/examples/generate_address.py" target="_blank" rel="noopener noreferrer">tronpy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>通过非信任的网络传输私钥会有泄露风险。请通过离线方式生成地址和私钥。</p></div> <h3 id="依赖环境"><a href="#依赖环境" class="header-anchor">#</a> 依赖环境</h3> <p>WINkLink 节点依赖 MySQL 实例。开发者可以使用目标环境的软件包管理器或 Docker 部署 MySQL 实例。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里假定本机部署的 MySQL 实例的用户名和密码分别是 <code>root:root</code>。在生产环境中请使用强密码或其他验证方式。</p></div> <p>WINkLink 节点使用 Java 语言编写，依赖 JRE/JDK 环境，建议使用 Oracle JDK8.</p> <p>WINkLink 节点依赖 nodejs 环境，需要安装 nodejs(npm) &gt;= 10.0.</p> <h3 id="获取节点可执行程序"><a href="#获取节点可执行程序" class="header-anchor">#</a> 获取节点可执行程序</h3> <p>开发者可以在 <a href="https://github.com/wink-link/winklink/releases" target="_blank" rel="noopener noreferrer">Github Release<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 页面下载到到最新版本的 WINkLink 节点可执行程序 <code>node-v1.0.jar</code>。</p> <p>也可以按照如下步骤编译:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 需要 jdk8, 和 nodejs(npm) &gt;= 10.0</span>
<span class="token function">git</span> clone git@github.com:wink-link/winklink.git
<span class="token builtin class-name">cd</span> winklink/

<span class="token comment"># 编译</span>
./gradlew build -x <span class="token builtin class-name">test</span>
</code></pre></div><p>编译完成后 <code>node-v1.0.jar</code> 位于项目源码目录下的 <code>node/build/libs/</code> 中。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>这里的编译过程中忽略了测试(<code>-x test</code>)，这是因为测试用例中包含交易所币价 API 测试用例，
这些测试用例需要稳定的非中国大陆网络环境。</p></div> <h3 id="节点配置"><a href="#节点配置" class="header-anchor">#</a> 节点配置</h3> <p>WINkLink 节点使用 springboot 方式配置。所有配置文件位于项目子目录 <code>node/src/main/resource</code>.
<code>application.yml</code> 可以指定使用的具体 profile.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># application.yml</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token comment"># dev|pro</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
        <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># 这里设置具体的 profile 文件，即 `application-dev.yml`</span>
    <span class="token key atrule">jackson</span><span class="token punctuation">:</span>
        <span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8
        <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss
    <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
        <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
            <span class="token key atrule">maxRequestSize</span><span class="token punctuation">:</span> <span class="token number">104857600</span> <span class="token comment">#100MB</span>

<span class="token comment"># ... (omitted)</span>
</code></pre></div><p><code>application-[ACTIVE_PROFILE_NAME].yml</code> 中可以指定具体的 MySQL 数据库连接配置，
默认 <code>dev</code> 使用本机实例，用户名密码为 <code>root:root</code>.</p> <p>节点配置文件确认完毕后，还需要创建 <code>key.store</code> 文件, 写入节点帐号的私钥:</p> <div class="language-text extra-class"><pre class="language-text"><code>privatekey=*****(32字节 hex 编码私钥)
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>通过文件而非命令行参数提供私密信息是重要的安全性考虑，在生产环境需要设定私密文件 <code>key.store</code> 权限为 600,
即只有拥有者可读写。</p></div> <h3 id="启动节点"><a href="#启动节点" class="header-anchor">#</a> 启动节点</h3> <p>所有配置文件都需要被复制到节点程序当前运行时目录，即 <code>cp node/src/main/resource/*.yml ./</code>.</p> <p>使用如下命令启动 WINkLink 节点程序：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>java -jar node/build/libs/node-v1.0.jar -k key.store
</code></pre></div><p>具体的配置项目也可以通过命令行指定，例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>java -jar node/build/libs/node-v1.0.jar --server.port<span class="token operator">=</span><span class="token number">8081</span> --spring.profiles.active<span class="token operator">=</span>dev --key key.store
</code></pre></div><p>使用如下命令判断 WINkLink 节点是否正常运行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">tail</span> -f logs/tron.log
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>节点帐号必须有足够的 TRX 代币，用于合约调用。可以通过测试网水龙头地址申请。</p></div> <h3 id="为节点添加-job"><a href="#为节点添加-job" class="header-anchor">#</a> 为节点添加 job</h3> <p>节点的 job 代表了节点所支持的数据服务, job ID 通过一个 32 字节唯一标识。对于最终用户来说，
<code>(Oracle 地址, job ID)</code> 唯一标识了一个 WINkLink 节点提供的数据服务。
每个 WINkLink 节点都可以提供多组数据服务。</p> <p>WINkLink 节点正常运行后，就可以通过 HTTP API 为节点添加 job:</p> <p>示例：(修改下面代码中 <code>address</code> 参数为上述步骤中部署的 Oracle 合约地址)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --location --request POST <span class="token string">'http://localhost:8080/job/specs'</span> <span class="token punctuation">\</span>
  --header <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
    --data-raw <span class="token string">'{
    &quot;initiators&quot;: [
        {
        &quot;type&quot;: &quot;runlog&quot;,
        &quot;params&quot;: {
            &quot;address&quot;: &quot;TR9jYcLWAcQfbKcP5oau1ccSbeW7mdnqg8&quot;
        }
        }
    ],
    &quot;tasks&quot;: [
        {
        &quot;type&quot;: &quot;httpget&quot;,
        &quot;params&quot;: {
            &quot;get&quot;: &quot;https://www.okex.com/api/spot/v3/instruments/TRX-USDT/ticker&quot;,
            &quot;path&quot;: &quot;last&quot;
        }
        },
        {
        &quot;type&quot;: &quot;multiply&quot;,
        &quot;params&quot;: {
            &quot;times&quot;: 1000000
        }
        },
        {
        &quot;type&quot;: &quot;trontx&quot;
        }
    ]
    }'</span>
</code></pre></div><h3 id="查询节点-job"><a href="#查询节点-job" class="header-anchor">#</a> 查询节点 job</h3> <p>请求示例：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --location --request GET <span class="token string">'http://localhost:8080/job/specs'</span>
</code></pre></div><h2 id="为节点账户授权"><a href="#为节点账户授权" class="header-anchor">#</a> 为节点账户授权</h2> <p>节点账户需要授权才能向 Oracle 合约提交数据，否则会报错 <code>&quot;Not an authorized node to fulfill requests&quot;</code>。</p> <p>需要使用 Oracle 合约的 owner 执行如下合约调用，将节点账户添加到白名单:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// setFulfillmentPermission(address,bool) [7fcd56db]</span>
<span class="token keyword">function</span> <span class="token function">setFulfillmentPermission</span><span class="token punctuation">(</span><span class="token parameter">address _node<span class="token punctuation">,</span> bool _allowed</span><span class="token punctuation">)</span>
</code></pre></div><p>其中 <code>_node</code> 为节点账户地址，<code>_allowed</code> 为 <code>true</code> 代表授权，为 <code>false</code> 代表撤销授权。</p> <p>示例调用例如 <code>setFulfillmentPermission(TGQVLckg1gDZS5wUwPTrPgRG4U8MKC4jcP, true)</code>。</p> <p>合约调用可以使用如下任一工具或程序库：</p> <ul><li>TronScan 区块链浏览器 <a href="https://tronscan.org/" target="_blank" rel="noopener noreferrer">Mainnet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://nile.tronscan.org/" target="_blank" rel="noopener noreferrer">Nile Testnet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/tronprotocol/wallet-cli" target="_blank" rel="noopener noreferrer">官方 wallet-cli 工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/docs/ide%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">TronIDE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/docs/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2" target="_blank" rel="noopener noreferrer">TronBox<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cn.developers.tron.network/reference#tronwebcontractat" target="_blank" rel="noopener noreferrer">tronweb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tronpy.readthedocs.io/en/latest/contract.html#creating-smart-contract" target="_blank" rel="noopener noreferrer">tronpy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/andelf/rust-tron/blob/master/docs/contract.md" target="_blank" rel="noopener noreferrer">rust-tron<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="申请成为官方认证-winklink-节点"><a href="#申请成为官方认证-winklink-节点" class="header-anchor">#</a> 申请成为官方认证 WINkLink 节点</h2> <p>以上步骤执行完毕后，节点即可对外提供服务。</p> <p>节点可以向社区公布自己的 Oracle 合约地址和所支持的数据服务 job ID. 也可以申请成为 WINkLink 官方认证节点，
在 WINkLink 官网列出自己的节点。</p> <p><a href="https://docs.google.com/forms/d/e/1FAIpQLSe5mX6ZR13jBTgkO3D7jgio8f5ASTVYBObx8AAlyGs0hYyiJw/viewform" target="_blank" rel="noopener noreferrer">申请表单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1/doc/architecture.html" class="prev">
        系统架构设计
      </a></span> <span class="next"><a href="/v1/doc/pricing.html">
        WINkLink 价格服务
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v1/doc/assets/js/app.2c857601.js" defer></script><script src="/v1/doc/assets/js/2.f2b16297.js" defer></script><script src="/v1/doc/assets/js/9.790d0f70.js" defer></script>
  </body>
</html>
