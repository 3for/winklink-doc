<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WINkLink Price Service | WINkLink Developer Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/v1/doc/favicon.ico">
    <meta name="description" content="WINkLink Developer Documentation">
    
    <link rel="preload" href="/v1/doc/assets/css/0.styles.80b33373.css" as="style"><link rel="preload" href="/v1/doc/assets/js/app.2c857601.js" as="script"><link rel="preload" href="/v1/doc/assets/js/2.f2b16297.js" as="script"><link rel="preload" href="/v1/doc/assets/js/14.3bc4688f.js" as="script"><link rel="prefetch" href="/v1/doc/assets/js/10.48fcf582.js"><link rel="prefetch" href="/v1/doc/assets/js/11.9452f0d4.js"><link rel="prefetch" href="/v1/doc/assets/js/12.ba475056.js"><link rel="prefetch" href="/v1/doc/assets/js/13.46041a7c.js"><link rel="prefetch" href="/v1/doc/assets/js/15.ccb561fe.js"><link rel="prefetch" href="/v1/doc/assets/js/16.c5d3ca82.js"><link rel="prefetch" href="/v1/doc/assets/js/17.c9435c6d.js"><link rel="prefetch" href="/v1/doc/assets/js/18.12b1d2e4.js"><link rel="prefetch" href="/v1/doc/assets/js/19.b9b0cb89.js"><link rel="prefetch" href="/v1/doc/assets/js/20.c870f8f0.js"><link rel="prefetch" href="/v1/doc/assets/js/21.07f05b3d.js"><link rel="prefetch" href="/v1/doc/assets/js/22.fb119882.js"><link rel="prefetch" href="/v1/doc/assets/js/23.572dfe6f.js"><link rel="prefetch" href="/v1/doc/assets/js/3.0862f354.js"><link rel="prefetch" href="/v1/doc/assets/js/4.273ae178.js"><link rel="prefetch" href="/v1/doc/assets/js/5.71746619.js"><link rel="prefetch" href="/v1/doc/assets/js/6.f5b065ee.js"><link rel="prefetch" href="/v1/doc/assets/js/7.25d11dd2.js"><link rel="prefetch" href="/v1/doc/assets/js/8.add5fbc5.js"><link rel="prefetch" href="/v1/doc/assets/js/9.790d0f70.js">
    <link rel="stylesheet" href="/v1/doc/assets/css/0.styles.80b33373.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v1/doc/en/" class="home-link router-link-active"><!----> <span class="site-name">WINkLink Developer Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/pricing.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/pricing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/pricing.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/pricing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/v1/doc/en/" aria-current="page" class="sidebar-link">Introduction to WINkLink</a></li><li><a href="/v1/doc/en/architecture.html" class="sidebar-link">Design of System Architecture</a></li><li><a href="/v1/doc/en/deploy.html" class="sidebar-link">Deploy WINkLink Node</a></li><li><a href="/v1/doc/en/pricing.html" aria-current="page" class="active sidebar-link">WINkLink Price Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#acquire-latest-prices" class="sidebar-link">Acquire Latest Prices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#price-history" class="sidebar-link">Price History</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#price-feed-contract" class="sidebar-link">Price Feed Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#mainnet" class="sidebar-link">Mainnet</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#nile-testnet" class="sidebar-link">Nile Testnet</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#apply-for-new-trading-pairs" class="sidebar-link">Apply for New Trading Pairs</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#deply-the-price-service" class="sidebar-link">Deply the Price Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#deploy-the-price-feed-contract" class="sidebar-link">Deploy the Price Feed Contract</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#add-an-oracle-node-and-a-job-id" class="sidebar-link">Add an Oracle Node and a job ID</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#transfer-win-tokens-to-the-contract" class="sidebar-link">Transfer WIN Tokens to the Contract</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/pricing.html#call-the-price-feed-contract" class="sidebar-link">Call the Price Feed Contract</a></li></ul></li></ul></li><li><a href="/v1/doc/en/v2.html" class="sidebar-link">FluxAggregator</a></li><li><a href="/v1/doc/en/proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/v1/doc/en/glossary.html" class="sidebar-link">Glossary</a></li><li><a href="/v1/doc/en/vrf.html" class="sidebar-link">WINkLink Random number Service</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="winklink-price-service"><a href="#winklink-price-service" class="header-anchor">#</a> WINkLink Price Service</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>It is required that smart contracts frequently echo the token prices in the real world. For DeFi in particular, asset prices must be highly aligned with real-world prices, otherwise users and developers may suffer losses caused by arbitrage or attacks on the contract.</p> <p>WINkLink's price service focuses on digital currency pairs, providing DApps with accurate and stable price information of real-world digital currencies.</p> <p>The solution provided by WINkLink aggregates price data of multiple WINkLink oracle nodes that leads to a stable price service, which is called the Price Feed Contract.</p> <p>We are going to explore how to use and deploy the WINkLink price service contract in the following sections.</p> <h2 id="acquire-latest-prices"><a href="#acquire-latest-prices" class="header-anchor">#</a> Acquire Latest Prices</h2> <p>Acquiring the latest price data in the consumer contract requires <code>AggregatorInterface</code>. It defines the interface that the Price Feed Contract provides to the public.</p> <div class="language-js extra-class"><pre class="language-js"><code>pragma solidity <span class="token operator">^</span><span class="token number">0.5</span><span class="token number">.0</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">AggregatorInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">latestAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>int256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">latestTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">latestRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">getAnswer</span><span class="token punctuation">(</span><span class="token parameter">uint256 roundId</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>int256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token parameter">uint256 roundId</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

contract PriceConsumer <span class="token punctuation">{</span>
    AggregatorInterface internal priceFeed<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Price Aggregator Address: TYZxQSHAhxGgUWzxYEZAohvWc9cQWXtNBt
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        priceFeed <span class="token operator">=</span> <span class="token function">AggregatorInterface</span><span class="token punctuation">(</span><span class="token number">0xF7e52418572834722ED87E9425d673FEdBD55a0e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns the latest price
     */</span>
    <span class="token keyword">function</span> <span class="token function">getLatestPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If the round is not complete yet, timestamp is 0</span>
        <span class="token function">require</span><span class="token punctuation">(</span>priceFeed<span class="token punctuation">.</span><span class="token function">latestTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Round not complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> priceFeed<span class="token punctuation">.</span><span class="token function">latestAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="price-history"><a href="#price-history" class="header-anchor">#</a> Price History</h3> <p>Price history can be acquired from the <code>AggregatorInterface</code> interface function list via <code>getAnswer(uint256 roundId)</code>.The corresponding timestamp can be acquired via <code>getTimestamp(uint256 roundId)</code>.</p> <h2 id="price-feed-contract"><a href="#price-feed-contract" class="header-anchor">#</a> Price Feed Contract</h2> <h3 id="mainnet"><a href="#mainnet" class="header-anchor">#</a> Mainnet</h3> <table><thead><tr><th>Pair</th> <th>Price Feed Contract Address</th></tr></thead> <tbody><tr><td>TRX-USD</td> <td><code>TNwqbPTDLgGQVfLz75NnaMfsrVHbKQBuCo</code></td></tr> <tr><td>JST-USD</td> <td><code>TAKipCT5xdCKkB8BTEGV8A9pysbnLSbK4v</code></td></tr> <tr><td>SUNOLD-USD</td> <td><code>THVdX8xZfjUtZEHFYDzZhQF6HzwjBeivo6</code></td></tr> <tr><td>BTC-USD</td> <td><code>TFBF8bBpQbrhzEZbTyXXPmB3a4tXmqqk7Y</code></td></tr> <tr><td>WIN-USD</td> <td><code>TBdQHu2hd5obmikZWn4KkuqmxaN1LCEp4U</code></td></tr> <tr><td>DICE-USD</td> <td><code>TYQh9z6g2aGB1mQwRzGvdFphkt1nEjAMY2</code></td></tr> <tr><td>USDJ-USD</td> <td><code>TBbg182ovR4Ra282MERwDwiyCVS2gtjF8g</code></td></tr> <tr><td>JST-TRX</td> <td><code>TCf4vSQLbHBFKzezHudEpvnhJ5GNQ6F2Ex</code></td></tr> <tr><td>WIN-TRX</td> <td><code>TR6LAm2T1kdqgZBYWBtyS9HXs11KhvK5cq</code></td></tr> <tr><td>DICE-TRX</td> <td><code>TLjFYyi7Va3nUfEgUiL5S1YgLqPYjv7aF4</code></td></tr> <tr><td>LIVE-USD</td> <td><code>TBpcwZo2Vk825nss6WSSdhVz7NWqt5aS1U</code></td></tr> <tr><td>USDT-USD</td> <td><code>TZ8u8sz1ToRfGaQ5JbYNwEiuRTXUBe9tFx</code></td></tr> <tr><td>SUNOLD-TRX</td> <td><code>TE14YrYpFtrPqxVSQ6V4WUsTniwfdcxbAR</code></td></tr> <tr><td>BTC-TRX</td> <td><code>TGNLjD435kXGoHi9JiFvrDr9SQE6eyu91X</code></td></tr> <tr><td>USDJ-TRX</td> <td><code>TDQA9eG9tmS7JbbFbzfcxvQn1Z9xuPt62V</code></td></tr> <tr><td>USDT-TRX</td> <td><code>TWBz6RPTbgEu9qY72NNRSZprD88DnHzizw</code></td></tr> <tr><td>BTT-USD</td> <td><code>THNCvWFdV3Qe2SeFWzz95XvjjsmBPtHi6q</code></td></tr> <tr><td>BTT-TRX</td> <td><code>TSEu2g6oD5ukHYvKbn2shc9mdpELySgbv9</code></td></tr> <tr><td>ETH-TRX</td> <td><code>TENtY6C9WiCpGenjUFwf33DYTcrV7GEZuh</code></td></tr></tbody></table> <h3 id="nile-testnet"><a href="#nile-testnet" class="header-anchor">#</a> Nile Testnet</h3> <ul><li>Contract List<a href="http://47.252.73.5:3300/#/solutions" target="_blank" rel="noopener noreferrer">View Page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>WIN    Token Contract Address: <code>TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</code></li> <li>WinkMid Contract Address: <code>TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb</code></li></ul> <p>List of price service contract addresses:</p> <table><thead><tr><th>Pair</th> <th>Price Feed Contract Address</th> <th>Oracle Contract Address</th> <th>job id</th></tr></thead> <tbody><tr><td>TRX-USD</td> <td><code>TAL6RWymPLepKsLGCzWPUTKQQcWFsuHfNE</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code><br><code>TEx4rxit3Au6ek5avy4Aiy1N6Fyt38AS3o</code></td> <td><code>bb347a9a63324fd995a7159cb0c8348a</code><br><code>40691f5fd4b64ab4a5442477ed484d80</code><br><code>f7ccb652cc254a19b0b954c49af25926</code><br><code>38cd68072a6c4a0ca05e9b91976cf4f1</code><br><code>328697ef599043e1a301ae985d06aabf</code></td></tr> <tr><td>JST-USD</td> <td><code>TYr8nvS9BUbi9eLXNQpUMbxdvwYpoWn3ho</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>b09f188f336844e2b4f93ec7c2cc238f</code><br><code>ca97ef49175a44078c2c2933287915fd</code><br><code>1f26180c61824d25b822d76972f16d7d</code><br><code>c10608a577214eba904a7673d4e97fca</code></td></tr> <tr><td>SUNOLD-USD</td> <td><code>TWWjBHU3KkuV65rTVkA4UrCrGwBRTXs3KK</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>884366e5e9e441d6a792f77907778345</code><br><code>e109e9a1dc26475a834446509468ac59</code><br><code>d528c7c0d4784d0d9b53b932694b44fe</code><br><code>3f0a614654704ec3b50da1612b478ecb</code></td></tr> <tr><td>BTC-USD</td> <td><code>TYY5GdNvHN8NVY6MYtgEPwx15pyUmLEw5J</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code><br><code>TEx4rxit3Au6ek5avy4Aiy1N6Fyt38AS3o</code></td> <td><code>5a0f83ca61d74bad961acd0912adc53f</code><br><code>4f929a07ad1b4efba8fa686ad9641738</code><br><code>7c2457a191bf43488419adf7c48d4ff0</code><br><code>83d851c6627e4fed8c0e24292e1dc42f</code><br><code>1fc45a68c7f346229f08aee1982daa0e</code></td></tr> <tr><td>WIN-USD</td> <td><code>TGPDYFAcFx8ZXf7sGTLwbvsDh8FdEnsNyN</code></td> <td><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>2f6c1f3dbb634e60910da542df34a94a</code><br><code>ca4821f3c5ef4b2cb8ee330a6f634520</code></td></tr> <tr><td>DICE-USD</td> <td><code>TS8fAMLNnbWgNyXz6queFHR7HfZkhAeppK</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>ad7888ed606d4b249edd298791f0c2d7</code></td></tr> <tr><td>USDJ-USDT</td> <td><code>TMmh7ZJkXpz4fE9FyFvRByMwvBE5Z2cRj8</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>b0ec07370a734d0cbdfabf6fe0e903c0</code></td></tr> <tr><td>JST-TRX</td> <td><code>THs9f15hC6r6rWzAE2NBUyiX2SetwDCnYD</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>4ac87bf722da4659ae9989c2ad7646ae</code></td></tr> <tr><td>WIN-TRX</td> <td><code>TReQocbkKBbGrgzoYWQ8bJnCNG1LGehwZw</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>febfcef0ce234fbdabaad191f2c4c542</code></td></tr> <tr><td>DICE-TRX</td> <td><code>TSejCUHkk5gD2UjtoPt3n3rdByTbKLac4Q</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>c22e485bb31a4680b7eff3dc590d8c8f</code></td></tr></tbody></table> <h3 id="apply-for-new-trading-pairs"><a href="#apply-for-new-trading-pairs" class="header-anchor">#</a> Apply for New Trading Pairs</h3> <p>If you need WINkLink to provide a new trading pair officially,
please fill in and submit the <a href="https://docs.google.com/forms/d/e/1FAIpQLSdt0xu6Sw7llvV0yu-4qJGkh3gvfBVFr_YPv01CEl7P19yXSQ/viewform" target="_blank" rel="noopener noreferrer">this form<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="deply-the-price-service"><a href="#deply-the-price-service" class="header-anchor">#</a> Deply the Price Service</h2> <p>Developers can deploy their own price services and customize price sources and the minimum number of response oracles.</p> <p>In real production, price feed requires multiple oracle nodes, which will be aggregated into a final price. But for the test, we only set up one node for price feed to streamline the test.</p> <h3 id="deploy-the-price-feed-contract"><a href="#deploy-the-price-feed-contract" class="header-anchor">#</a> Deploy the Price Feed Contract</h3> <p>Launched by WINkLink, the <code>TronUser</code> contract is a contract template for aggregated price service. The contract applies the <code>AggregatorInterface</code> which developers can use directly.</p> <p>The contract code is located at <a href="https://github.com/wink-link/winklink/blob/master/tvm-contracts/v1.0/TronUser.sol" target="_blank" rel="noopener noreferrer">TronUser.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In deploying the TronUser contract, the WIN token address and WinkMid contract address are required in the constructor. For example, on Nile TestNet,
<code>(TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2, TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb)</code> is required.</p> <h3 id="add-an-oracle-node-and-a-job-id"><a href="#add-an-oracle-node-and-a-job-id" class="header-anchor">#</a> Add an Oracle Node and a job ID</h3> <p>After the TronUser contract is deployed, the contract owner should set up an oracle service list of the aggregated requests for the contract with the following interface:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateRequestDetails</span><span class="token punctuation">(</span><span class="token parameter">uint128 _paymentAmount<span class="token punctuation">,</span> uint128 _minimumResponses<span class="token punctuation">,</span> address<span class="token punctuation">[</span><span class="token punctuation">]</span> _oracles<span class="token punctuation">,</span> bytes32<span class="token punctuation">[</span><span class="token punctuation">]</span> _jobIds</span><span class="token punctuation">)</span>
</code></pre></div><p><code>_paymentAmount</code> refers to the amount of tokens paid for updating the call each time.</p> <p><code>_oracles</code> and <code>_jobIds</code> are a pair of lists with equal length. Each set represents a unique job ID of a WINkLink oracle.</p> <p><code>_minimumResponses</code> refers to the minimum number of response oracles. It must be greater than or equal to the length of <code>_oracles</code>. For example, you can set it to 5/10 so that only when at least 5/10 oracles have responded will the upgraded value become valid.</p> <p>Call example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">updateRequestDetails</span><span class="token punctuation">(</span>
  <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;TR9jYcLWAcQfbKcP5oau1ccSbeW7mdnqg8&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">&quot;db22ccf4b4a14d0cae2a0757632e425d&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="transfer-win-tokens-to-the-contract"><a href="#transfer-win-tokens-to-the-contract" class="header-anchor">#</a> Transfer WIN Tokens to the Contract</h3> <p>TronUser contract needs <code>transferAndCall</code> to call the Oracle contract, so there should be enough WIN tokens in the contract account. You can transfer a certain amount of WIN tokens for the contract through the transfer service or the TestNet Faucet.</p> <h3 id="call-the-price-feed-contract"><a href="#call-the-price-feed-contract" class="header-anchor">#</a> Call the Price Feed Contract</h3> <h4 id="update-prices-with-requestrateupdate"><a href="#update-prices-with-requestrateupdate" class="header-anchor">#</a> Update Prices with requestRateUpdate</h4> <p>Use the following interface to request WINkLink oracle nodes to acquire the latest price information from external data sources:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">requestRateUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bytes32<span class="token punctuation">)</span>
</code></pre></div><p>The interface returns a <code>requestID</code>, which can also be used to cancel this price update request.</p> <h4 id="acquire-latest-prices-with-latestanswer"><a href="#acquire-latest-prices-with-latestanswer" class="header-anchor">#</a> Acquire Latest Prices with latestAnswer</h4> <p>Acquire latest prices by calling <code>latestAnswer()</code> in <code>AggregatorInterface</code>.</p> <p>You can call it to on the TronScan's contract information page.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1/doc/en/deploy.html" class="prev">
        Deploy WINkLink Node
      </a></span> <span class="next"><a href="/v1/doc/en/v2.html">
        FluxAggregator
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v1/doc/assets/js/app.2c857601.js" defer></script><script src="/v1/doc/assets/js/2.f2b16297.js" defer></script><script src="/v1/doc/assets/js/14.3bc4688f.js" defer></script>
  </body>
</html>
