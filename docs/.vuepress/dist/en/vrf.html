<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WINkLink Random number Service | WINkLink Developer Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/v1/doc/favicon.ico">
    <meta name="description" content="WINkLink Developer Documentation">
    
    <link rel="preload" href="/v1/doc/assets/css/0.styles.80b33373.css" as="style"><link rel="preload" href="/v1/doc/assets/js/app.2c857601.js" as="script"><link rel="preload" href="/v1/doc/assets/js/2.f2b16297.js" as="script"><link rel="preload" href="/v1/doc/assets/js/17.c9435c6d.js" as="script"><link rel="prefetch" href="/v1/doc/assets/js/10.48fcf582.js"><link rel="prefetch" href="/v1/doc/assets/js/11.9452f0d4.js"><link rel="prefetch" href="/v1/doc/assets/js/12.ba475056.js"><link rel="prefetch" href="/v1/doc/assets/js/13.46041a7c.js"><link rel="prefetch" href="/v1/doc/assets/js/14.3bc4688f.js"><link rel="prefetch" href="/v1/doc/assets/js/15.ccb561fe.js"><link rel="prefetch" href="/v1/doc/assets/js/16.c5d3ca82.js"><link rel="prefetch" href="/v1/doc/assets/js/18.12b1d2e4.js"><link rel="prefetch" href="/v1/doc/assets/js/19.b9b0cb89.js"><link rel="prefetch" href="/v1/doc/assets/js/20.c870f8f0.js"><link rel="prefetch" href="/v1/doc/assets/js/21.07f05b3d.js"><link rel="prefetch" href="/v1/doc/assets/js/22.fb119882.js"><link rel="prefetch" href="/v1/doc/assets/js/23.572dfe6f.js"><link rel="prefetch" href="/v1/doc/assets/js/3.0862f354.js"><link rel="prefetch" href="/v1/doc/assets/js/4.273ae178.js"><link rel="prefetch" href="/v1/doc/assets/js/5.71746619.js"><link rel="prefetch" href="/v1/doc/assets/js/6.f5b065ee.js"><link rel="prefetch" href="/v1/doc/assets/js/7.25d11dd2.js"><link rel="prefetch" href="/v1/doc/assets/js/8.add5fbc5.js"><link rel="prefetch" href="/v1/doc/assets/js/9.790d0f70.js">
    <link rel="stylesheet" href="/v1/doc/assets/css/0.styles.80b33373.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v1/doc/en/" class="home-link router-link-active"><!----> <span class="site-name">WINkLink Developer Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/vrf.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/vrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/vrf.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/vrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/v1/doc/en/" aria-current="page" class="sidebar-link">Introduction to WINkLink</a></li><li><a href="/v1/doc/en/architecture.html" class="sidebar-link">Design of System Architecture</a></li><li><a href="/v1/doc/en/deploy.html" class="sidebar-link">Deploy WINkLink Node</a></li><li><a href="/v1/doc/en/pricing.html" class="sidebar-link">WINkLink Price Service</a></li><li><a href="/v1/doc/en/v2.html" class="sidebar-link">FluxAggregator</a></li><li><a href="/v1/doc/en/proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/v1/doc/en/glossary.html" class="sidebar-link">Glossary</a></li><li><a href="/v1/doc/en/vrf.html" aria-current="page" class="active sidebar-link">WINkLink Random number Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#before-you-start" class="sidebar-link">Before you start</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#vrfcoordinator-contract" class="sidebar-link">VRFCoordinator Contract</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#tron-mainnet-winklink-info" class="sidebar-link">Tron Mainnet WINkLink Info</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#node-deployment" class="sidebar-link">Node Deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#node-configuration" class="sidebar-link">Node Configuration</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#start-a-node" class="sidebar-link">Start a Node</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#add-a-job-to-your-node" class="sidebar-link">Add a Job to Your Node</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#query-jobs" class="sidebar-link">Query Jobs</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#authorize-a-node-account" class="sidebar-link">Authorize a Node Account</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#dapp-contract" class="sidebar-link">Dapp Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#dapp-contract-deployment" class="sidebar-link">Dapp Contract Deployment</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#transfer-win-tokens-to-the-contract" class="sidebar-link">Transfer WIN Tokens to the Contract</a></li><li class="sidebar-sub-header"><a href="/v1/doc/en/vrf.html#call-the-dapp-contract" class="sidebar-link">Call the Dapp Contract</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="winklink-random-number-service"><a href="#winklink-random-number-service" class="header-anchor">#</a> WINkLink Random number Service</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Verifiable Random Function (VRF) is the public-key version of a keyed cryptographic hash, which can be used as a random number. Only the holder of the private key can compute the hash, but anyone with the public key can verify the correctness of the hash.
VRF can be used to generate secure and reliable random numbers.</p> <p>Random number is determined by seed (provided by users), nonce (private state of VRFCoordinator contract) , block hash (the block of the request event) and private key of oracle node.</p> <p>The generation process of VRF is:</p> <ul><li>A Dapp contract sends out an on-chain request for a random number;</li> <li>Once the off-chain oracle node listens for the request, it generates a random number attaching the cryptographic proof to make the generated random number verifiable, and then submits them back to an oracle contract (VRFCoordinator);</li> <li>Once the random number proof is verified by the oracle contract, the random number is published to the Dapp contract through a callback function.</li></ul> <p>The process above ensures that the random number cannot be tampered with nor manipulated by anyone, including oracle operators, miners, users and even smart contract developers.</p> <p>WINkLink VRF is a provably-fair and verifiable source of randomness designed for Dapp contracts. Dapp contract developers can use WINkLink VRF as a tamper-proof RNG (Random Number Generator) to build reliable smart contracts for any applications which rely on unpredictable random number:</p> <ul><li>Blockchain games and NFTs</li> <li>Random assignment of duties and resources (e.g. randomly assigning judges to cases)</li> <li>Choosing a representative sample for consensus mechanisms</li></ul> <p>This article describes how to deploy and use the WINkLink VRF service.</p> <h2 id="before-you-start"><a href="#before-you-start" class="header-anchor">#</a> Before you start</h2> <p>Maintainers for WINkLink need to understand how the TRON platform works, and know about smart contract deployment and the process of calling them. You're suggested to read related <a href="https://cn.developers.tron.network/" target="_blank" rel="noopener noreferrer">TRON official documents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, particularly those on contract deployment on TronIDE.</p> <p>Prepare the node account. You should read related <a href="https://doc.winklink.org/v1/doc/en/deploy.html#prepare-node-account" target="_blank" rel="noopener noreferrer">Node account preparation doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="vrfcoordinator-contract"><a href="#vrfcoordinator-contract" class="header-anchor">#</a> VRFCoordinator Contract</h2> <p>VRFCoordinator contract is deployed on the TRON public chain with the following features:</p> <ul><li>Receive random number requests from Dapp contract and emit VRFRequest event
<ul><li>WIN transfer as fees, will be sent along with the request</li></ul></li> <li>Accept random number and the proof submitted from WINkLink node
<ul><li>VRFCoordinator contract will verify the proof before sending the random number to Dapp contract</li></ul></li> <li>Calculate the WINkLink node rewards for the request fulfilment</li></ul> <p>VRFCoordinator contract code is available at <a href="https://github.com/wink-link/winklink/blob/feature/rename2wink/tvm-contracts/v1.0/VRF/VRFCoordinator.sol" target="_blank" rel="noopener noreferrer">VRFCoordinator.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> .</p> <p>Some parameters are needed in the constructor function when deploying a VRFCoordinator contract:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">constructor</span><span class="token punctuation">(</span>address _win<span class="token punctuation">,</span> address _winkMid<span class="token punctuation">,</span> address _blockHashStore<span class="token punctuation">)</span>
</code></pre></div><p><code>_blockHashStore</code> BlockHashStore address, <code>_win</code> WIN token address, <code>_winkMid</code> WinkMid contract address.</p> <p>For convenience, Nile testnet has deployed <code>WinkMid</code> contract and encapsulated the <code>WIN</code> token on it. Developers can use this contract address directly without additional deployment. Users can also claim test TRX and WIN tokens from the Faucet address provided by Nile testnet.</p> <div class="custom-block tip"><p class="custom-block-title">Nile Testnet</p> <ul><li>WIN TRC20 Contract Address: <code>TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</code></li> <li>WinkMid Contract Address: <code>TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb</code></li> <li>Testnet Faucet: <a href="https://nileex.io/join/getJoinPage" target="_blank" rel="noopener noreferrer">https://nileex.io/join/getJoinPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="tron-mainnet-winklink-info"><a href="#tron-mainnet-winklink-info" class="header-anchor">#</a> Tron Mainnet WINkLink Info</h2> <table><thead><tr><th style="text-align:left;">Item</th> <th style="text-align:left;">Value</th></tr></thead> <tbody><tr><td style="text-align:left;">LINK Token</td> <td style="text-align:left;">TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7</td></tr> <tr><td style="text-align:left;">WinkMid</td> <td style="text-align:left;">TKy2MGKR6rQKBwM7dneUEnh2kvsodRR1Jo</td></tr> <tr><td style="text-align:left;">VRFCoordinator</td> <td style="text-align:left;">TTMLZ9e14KVCXkQrCSGRBS4r5iQPXGP1bA</td></tr> <tr><td style="text-align:left;">Key Hash 1</td> <td style="text-align:left;">0x284367a1c6c6cfee60d3343b399e8353da9a1482bdfddb549d217787a4c558f2</td></tr> <tr><td style="text-align:left;">Key Hash 2</td> <td style="text-align:left;">0x489db76c028fb5020e0c3d4fd7126f9c2750c7f52f3e03941c5bfcbe1c27d2a5</td></tr> <tr><td style="text-align:left;">Key Hash 3</td> <td style="text-align:left;">0xe90fbf3bd9cce99d28f7110a4afaa965f03061a6d6dd5a6f6dd6b0f937d73a63</td></tr> <tr><td style="text-align:left;">fee</td> <td style="text-align:left;">4 WIN</td></tr></tbody></table> <h2 id="node-deployment"><a href="#node-deployment" class="header-anchor">#</a> Node Deployment</h2> <p>For node deployment, please refer to <a href="https://doc.winklink.org/v1/doc/en/deploy.html" target="_blank" rel="noopener noreferrer">WINkLink Node Deploy Doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> .  This section only lists the differences of VRF node deployment.</p> <p>WINkLink node should be deployed after the VRFCoordinator contract is deployed.</p> <p>WINkLink node (project directory <code>node</code>) code is available at: <a href="https://github.com/wink-link/winklink/tree/feature/rename2wink/node" target="_blank" rel="noopener noreferrer">https://github.com/wink-link/winklink/tree/feature/rename2wink/node<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>After compilation, <code>node-v1.0.jar</code> will be stored in <code>node/build/libs/</code> under the project root directory.</p> <h3 id="node-configuration"><a href="#node-configuration" class="header-anchor">#</a> Node Configuration</h3> <p>After the node configuration file is confirmed, it is required to create a <code>vrfKeyStore.yml</code> file and set the private key for VRF (support multiple VRF private keys in one node):</p> <div class="language-text extra-class"><pre class="language-text"><code>privateKeys:
  - *****(private key in hexadecimal format)
</code></pre></div><p>Support for dynamically updating vrfkeystore without restarting the node server. The steps are:</p> <p>First, add a new VRF private key to the <code>vrfKeyStore.yml</code></p> <p>Second, execute the following command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --location --request GET <span class="token string">'http://localhost:8081/vrf/updateVRFKey/vrfKeyStore.yml'</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is for important safety concerns that you use files to provide private information instead of the command line. In the production environment, set the permission of the private file <code>vrfKeyStore</code> as 600, meaning that only the owner can read or write the data.</p></div> <h3 id="start-a-node"><a href="#start-a-node" class="header-anchor">#</a> Start a Node</h3> <p>All configuration files need to be copied to the directory where your node is running in, use the command <code>cp node/src/main/resource/*.yml ./</code>.
At the same time, the <code>tronApiKey</code> part of the <code>application dev</code> file needs to be filled with apikey.</p> <p>Start your WINkLink node using the following command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>java -jar node/build/libs/node-v1.0.jar -k key.store -vrfK vrfKeyStore.yml
</code></pre></div><p>Configuration items can also be specified using a command line. For example:</p> <p>mainnet:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>java -jar node/build/libs/node-v1.0.jar --server.port<span class="token operator">=</span><span class="token number">8081</span> --spring.profiles.active<span class="token operator">=</span>dev --key key.store  --vrfKey vrfKeyStore.yml
</code></pre></div><p>nile testnet:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>java -jar node/build/libs/node-v1.0.jar --env dev --server.port<span class="token operator">=</span><span class="token number">8081</span> --spring.profiles.active<span class="token operator">=</span>dev --key key.store  --vrfKey vrfKeyStore.yml
</code></pre></div><p>Determine whether your WINkLink node is running properly using the following command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">tail</span> -f logs/tron.log
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Your node account must have enough TRX tokens for contract calls.
You can apply testnet tokens at Testnet Faucet.</p></div> <h3 id="add-a-job-to-your-node"><a href="#add-a-job-to-your-node" class="header-anchor">#</a> Add a Job to Your Node</h3> <p>The job of your node represents the data service that your node supports, and each job has a unique 32-byte ID.</p> <p>When your WINkLink node is running properly, you can add a job to your node via HTTP API:</p> <p>Example: (change the parameter below:  <code>address</code>  is the VRFCoordinator contract address deployed in the steps above;
<code>publicKey</code> is the compressed value of the node's public key, which can be obtained by viewing the terminal display after the node starts, and the corresponding item is <code>eckey compressed</code>)</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --location --request POST <span class="token string">'http://localhost:8081/job/specs'</span> <span class="token punctuation">\</span>
  --header <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
    --data-raw <span class="token string">'{
    &quot;initiators&quot;: [
        {
        &quot;type&quot;: &quot;randomnesslog&quot;,
        &quot;params&quot;: {
            &quot;address&quot;: &quot;TYmwSFuFuiDZCtYsRFKCNr25byeqHH7Esb&quot;
        }
        }
    ],
    &quot;tasks&quot;: [
        {
        &quot;type&quot;: &quot;random&quot;,
        &quot;params&quot;: {
        &quot;publicKey&quot;:&quot;0x024e6bda4373bea59ec613b8721bcbb56222ab2ec10b18ba24ae369b7b74ab1452&quot;
        }
        },
        {
        &quot;type&quot;: &quot;trontx&quot;,
        &quot;params&quot;: {
            &quot;type&quot;: &quot;TronVRF&quot;
        }
	}
    ]
    }'</span>
</code></pre></div><h3 id="query-jobs"><a href="#query-jobs" class="header-anchor">#</a> Query Jobs</h3> <p>Request example:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> --location --request GET <span class="token string">'http://localhost:8081/job/specs'</span>
</code></pre></div><h2 id="authorize-a-node-account"><a href="#authorize-a-node-account" class="header-anchor">#</a> Authorize a Node Account</h2> <p>Node account needs authorization to submit data to VRFCoordinator contract, otherwise error will be reported.</p> <p>The owner of the VRFCoordinator contract is required to call the contract below and add the node account to the whitelist:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">registerProvingKey</span><span class="token punctuation">(</span><span class="token parameter">uint256 _fee<span class="token punctuation">,</span> address _oracle<span class="token punctuation">,</span> bytes calldata _publicProvingKey<span class="token punctuation">,</span> bytes32 _jobID</span><span class="token punctuation">)</span>
</code></pre></div><p><code>_fee</code> is the minimum WIN token cost required for the registration node to generate random numbers,
<code>_oracle</code> is the address of the registered node, which is used to receive the WIN token paid by DAPP ,
<code>_publicProvingKey</code> is the public key used by the registration node to generate random numbers, which is <code>x || y</code>,
<code>_jobID</code> is the jobID of VRF service of the node.</p> <p>Call example: <code>registerProvingKey（10,TYmwSFuFuiDZCtYsRFKCNr25byeqHH7Esb, 0x4e6bda4373bea59ec613b8721bcbb56222ab2ec10b18ba24ae369b7b74ab145224d509bc2778e6d1c8a093522ba7f9b6669a9aef57d2231f856e4b594ad5f4ac, 04d773890bc347f88544dc85bea24985）</code></p> <h2 id="dapp-contract"><a href="#dapp-contract" class="header-anchor">#</a> Dapp Contract</h2> <p>An example of a Dapp contract code is available at  <a href="https://github.com/wink-link/winklink/blob/feature/rename2wink/tvm-contracts/v1.0/VRF/VRFD20.sol" target="_blank" rel="noopener noreferrer">VRFD20.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>In this example, we'll create a contract with a Game of Thrones theme. It will request randomness from Chainlink VRF, the result of which it will transform into a number between 1 and 20, mimicking the rolling of a 20 sided dice. Each number represents a Game of Thrones house. So, if you land a 1, you are assigned house Targaryan, 2 is Lannister, and so on.</p> <p>When rolling the dice, it will accept an address variable to track which address is assigned to each house.</p> <p>When writing for a new Dapp contract, the main steps are:</p> <ul><li>a) Import VRFConsumerBase:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  pragma solidity <span class="token operator">^</span><span class="token number">0.6</span><span class="token number">.0</span><span class="token punctuation">;</span>

  <span class="token keyword">import</span> <span class="token string">&quot;./VRFConsumerBase.sol&quot;</span><span class="token punctuation">;</span>
  
  contract <span class="token constant">VRFD20</span> is VRFConsumerBase <span class="token punctuation">{</span>
  
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>b) Set <code>s_keyHash</code> to identify the VRF key to generate the random number; <code>s_fee</code> for the fee amount in one request.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  bytes32 <span class="token keyword">private</span> s_keyHash<span class="token punctuation">;</span>
  uint256 <span class="token keyword">private</span> s_fee<span class="token punctuation">;</span>
</code></pre></div><ul><li>c) Dapp contract initialization:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">constructor</span><span class="token punctuation">(</span>address vrfCoordinator<span class="token punctuation">,</span> address win<span class="token punctuation">,</span> address winkMid<span class="token punctuation">,</span> bytes32 keyHash<span class="token punctuation">,</span> uint256 fee<span class="token punctuation">)</span>
    <span class="token keyword">public</span>
    <span class="token function">VRFConsumerBase</span><span class="token punctuation">(</span><span class="token parameter">vrfCoordinator<span class="token punctuation">,</span> win<span class="token punctuation">,</span> winkMid</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    s_keyHash <span class="token operator">=</span> keyHash<span class="token punctuation">;</span>
    s_fee <span class="token operator">=</span> fee<span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>d) Call <code>requestRandomness</code> to request for random number, and get <code>requestId</code> for the specific request:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">rollDice</span><span class="token punctuation">(</span><span class="token parameter">uint256 userProvidedSeed<span class="token punctuation">,</span> address roller</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">require</span><span class="token punctuation">(</span>winkMid<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> s_fee<span class="token punctuation">,</span> <span class="token string">&quot;Not enough WIN to pay fee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    requestId <span class="token operator">=</span> <span class="token function">requestRandomness</span><span class="token punctuation">(</span>s_keyHash<span class="token punctuation">,</span> s_fee<span class="token punctuation">,</span> userProvidedSeed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    emit <span class="token function">DiceRolled</span><span class="token punctuation">(</span>requestId<span class="token punctuation">,</span> roller<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>e) Fulfill <code>fulfillRandomness</code> used by VRFCoordinator contract to send the verified random number <code>randomness</code> (for a specific request <code>requestId</code>) back to.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">fulfillRandomness</span><span class="token punctuation">(</span><span class="token parameter">bytes32 requestId<span class="token punctuation">,</span> uint256 randomness</span><span class="token punctuation">)</span> internal override <span class="token punctuation">{</span>
    uint256 d20Value <span class="token operator">=</span> randomness<span class="token punctuation">.</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s_results<span class="token punctuation">[</span>s_rollers<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> d20Value<span class="token punctuation">;</span> 
    emit <span class="token function">DiceLanded</span><span class="token punctuation">(</span>requestId<span class="token punctuation">,</span> d20Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="dapp-contract-deployment"><a href="#dapp-contract-deployment" class="header-anchor">#</a> Dapp Contract Deployment</h3> <p>Some parameters are needed in the constructor function when deploying a Dapp contract</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">constructor</span><span class="token punctuation">(</span>address vrfCoordinator<span class="token punctuation">,</span> address win<span class="token punctuation">,</span> address winkMid<span class="token punctuation">,</span> bytes32 keyHash<span class="token punctuation">,</span> uint256 fee<span class="token punctuation">)</span>
</code></pre></div><p><code>vrfCoordinator</code> the address of VRFCoordinator, <code>win</code> WIN token address, <code>winkMid</code> WinkMid contract address,
<code>keyHash</code> the hash value of the public key of the registered node, which can be obtained by calling the <code>hashofkeybytes</code> function of the VRFCoordinator contract (input is <code>x || y</code>).
<code>fee</code> the WIN token fee payed for generating random number, and its value should be greater than the fee required by random number node.</p> <p>Example:  <code>constructor（TUeVYd9ZYeKh87aDA9Tp7F5Ljc47JKC37x,TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2, TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb,0xe4f280f6d621db4bccd8568197e3c84e3f402c963264369a098bb2f0922cb125,12）</code>.</p> <h3 id="transfer-win-tokens-to-the-contract"><a href="#transfer-win-tokens-to-the-contract" class="header-anchor">#</a> Transfer WIN Tokens to the Contract</h3> <p>VRFD20 contract needs to call the VRFCoordinator contract, so there should be enough WIN tokens in the contract account. You can transfer a certain amount of WIN tokens for the contract through the transfer service or the TestNet Faucet.</p> <h3 id="call-the-dapp-contract"><a href="#call-the-dapp-contract" class="header-anchor">#</a> Call the Dapp Contract</h3> <p>Use the following interface to request random number:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">rollDice</span><span class="token punctuation">(</span><span class="token parameter">uint256 userProvidedSeed<span class="token punctuation">,</span> address roller</span><span class="token punctuation">)</span>
</code></pre></div><p><code>userProvidedSeed</code> the seed provided by the user,<code>roller</code> You can fill in any address at present.
Call example: <code>rollDice(0x852f725894485e4979af5ea47ddd90cc68ea1ac0f4b99e52e9b91fa35a7204e2, TL44GNkjETr2JumQHgYJF842oyE6h2inoR)</code>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1/doc/en/glossary.html" class="prev">
        Glossary
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v1/doc/assets/js/app.2c857601.js" defer></script><script src="/v1/doc/assets/js/2.f2b16297.js" defer></script><script src="/v1/doc/assets/js/17.c9435c6d.js" defer></script>
  </body>
</html>
