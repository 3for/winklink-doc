<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WINkLink 价格服务 | WINkLink 开发文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/v1/doc/favicon.ico">
    <meta name="description" content="WINkLink 开发和使用手册">
    
    <link rel="preload" href="/v1/doc/assets/css/0.styles.80b33373.css" as="style"><link rel="preload" href="/v1/doc/assets/js/app.2c857601.js" as="script"><link rel="preload" href="/v1/doc/assets/js/2.f2b16297.js" as="script"><link rel="preload" href="/v1/doc/assets/js/19.b9b0cb89.js" as="script"><link rel="prefetch" href="/v1/doc/assets/js/10.48fcf582.js"><link rel="prefetch" href="/v1/doc/assets/js/11.9452f0d4.js"><link rel="prefetch" href="/v1/doc/assets/js/12.ba475056.js"><link rel="prefetch" href="/v1/doc/assets/js/13.46041a7c.js"><link rel="prefetch" href="/v1/doc/assets/js/14.3bc4688f.js"><link rel="prefetch" href="/v1/doc/assets/js/15.ccb561fe.js"><link rel="prefetch" href="/v1/doc/assets/js/16.c5d3ca82.js"><link rel="prefetch" href="/v1/doc/assets/js/17.c9435c6d.js"><link rel="prefetch" href="/v1/doc/assets/js/18.12b1d2e4.js"><link rel="prefetch" href="/v1/doc/assets/js/20.c870f8f0.js"><link rel="prefetch" href="/v1/doc/assets/js/21.07f05b3d.js"><link rel="prefetch" href="/v1/doc/assets/js/22.fb119882.js"><link rel="prefetch" href="/v1/doc/assets/js/23.572dfe6f.js"><link rel="prefetch" href="/v1/doc/assets/js/3.0862f354.js"><link rel="prefetch" href="/v1/doc/assets/js/4.273ae178.js"><link rel="prefetch" href="/v1/doc/assets/js/5.71746619.js"><link rel="prefetch" href="/v1/doc/assets/js/6.f5b065ee.js"><link rel="prefetch" href="/v1/doc/assets/js/7.25d11dd2.js"><link rel="prefetch" href="/v1/doc/assets/js/8.add5fbc5.js"><link rel="prefetch" href="/v1/doc/assets/js/9.790d0f70.js">
    <link rel="stylesheet" href="/v1/doc/assets/css/0.styles.80b33373.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v1/doc/" class="home-link router-link-active"><!----> <span class="site-name">WINkLink 开发文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/pricing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/pricing.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v1/doc/pricing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v1/doc/en/pricing.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/v1/doc/" aria-current="page" class="sidebar-link">项目介绍</a></li><li><a href="/v1/doc/architecture.html" class="sidebar-link">系统架构设计</a></li><li><a href="/v1/doc/deploy.html" class="sidebar-link">搭建 WINkLink 节点</a></li><li><a href="/v1/doc/pricing.html" aria-current="page" class="active sidebar-link">WINkLink 价格服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#获取最新价格" class="sidebar-link">获取最新价格</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#历史价格" class="sidebar-link">历史价格</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#喂价合约" class="sidebar-link">喂价合约</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#主网" class="sidebar-link">主网</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#nile-测试网" class="sidebar-link">Nile 测试网</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#申请新交易对" class="sidebar-link">申请新交易对</a></li></ul></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#部署价格服务" class="sidebar-link">部署价格服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#部署喂价合约" class="sidebar-link">部署喂价合约</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#添加预言机节点以及-job-id" class="sidebar-link">添加预言机节点以及 job ID</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#为合约转入-win-代币" class="sidebar-link">为合约转入 WIN 代币</a></li><li class="sidebar-sub-header"><a href="/v1/doc/pricing.html#调用喂价合约" class="sidebar-link">调用喂价合约</a></li></ul></li></ul></li><li><a href="/v1/doc/v2.html" class="sidebar-link">v2 FluxAggregator</a></li><li><a href="/v1/doc/proxy.html" class="sidebar-link">代理合约</a></li><li><a href="/v1/doc/glossary.html" class="sidebar-link">术语表</a></li><li><a href="/v1/doc/vrf.html" class="sidebar-link">WINkLink 随机数服务</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="winklink-价格服务"><a href="#winklink-价格服务" class="header-anchor">#</a> WINkLink 价格服务</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>智能合约经常需要对真实世界的代币资产价格做响应，在 DeFi 领域更是如此，资产价格必须和真实世界价格高度对应，
否则用户和开发者可能承受合约被套利或攻击带来的损失。</p> <p>WINkLink 价格服务专注于数字货币价格对, 为 DApp 提供准确稳定的外部世界数字货币价格信息。</p> <p>WINkLink 官方提供了聚合多个 WINkLink 预言机节点价格数据的方案，最终得到稳定的价格服务，称作喂价合约(Price Feed Contract).</p> <p>本文介绍如何使用和部署 WINkLink 价格服务合约。</p> <h2 id="获取最新价格"><a href="#获取最新价格" class="header-anchor">#</a> 获取最新价格</h2> <p>消费者合约中获取最新价格数据需要引入 <code>AggregatorInterface</code>, 该接口定义了喂价服务对外提供的接口。</p> <div class="language-js extra-class"><pre class="language-js"><code>pragma solidity <span class="token operator">^</span><span class="token number">0.5</span><span class="token number">.0</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">AggregatorInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">latestAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>int256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">latestTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">latestRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">getAnswer</span><span class="token punctuation">(</span><span class="token parameter">uint256 roundId</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>int256<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token parameter">uint256 roundId</span><span class="token punctuation">)</span> external view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

contract PriceConsumer <span class="token punctuation">{</span>
    AggregatorInterface internal priceFeed<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Price Aggregator Address: TYZxQSHAhxGgUWzxYEZAohvWc9cQWXtNBt
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        priceFeed <span class="token operator">=</span> <span class="token function">AggregatorInterface</span><span class="token punctuation">(</span><span class="token number">0xF7e52418572834722ED87E9425d673FEdBD55a0e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Returns the latest price
     */</span>
    <span class="token keyword">function</span> <span class="token function">getLatestPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If the round is not complete yet, timestamp is 0</span>
        <span class="token function">require</span><span class="token punctuation">(</span>priceFeed<span class="token punctuation">.</span><span class="token function">latestTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Round not complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> priceFeed<span class="token punctuation">.</span><span class="token function">latestAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="历史价格"><a href="#历史价格" class="header-anchor">#</a> 历史价格</h3> <p>由 <code>AggregatorInterface</code> 接口函数列表，通过 <code>getAnswer(uint256 roundId)</code> 可以获取历史价格信息。对应的时间戳通过
<code>getTimestamp(uint256 roundId)</code> 获得。</p> <h2 id="喂价合约"><a href="#喂价合约" class="header-anchor">#</a> 喂价合约</h2> <h3 id="主网"><a href="#主网" class="header-anchor">#</a> 主网</h3> <table><thead><tr><th>Pair</th> <th>喂价合约地址</th></tr></thead> <tbody><tr><td>TRX-USD</td> <td><code>TNwqbPTDLgGQVfLz75NnaMfsrVHbKQBuCo</code></td></tr> <tr><td>JST-USD</td> <td><code>TAKipCT5xdCKkB8BTEGV8A9pysbnLSbK4v</code></td></tr> <tr><td>SUNOLD-USD</td> <td><code>THVdX8xZfjUtZEHFYDzZhQF6HzwjBeivo6</code></td></tr> <tr><td>BTC-USD</td> <td><code>TFBF8bBpQbrhzEZbTyXXPmB3a4tXmqqk7Y</code></td></tr> <tr><td>WIN-USD</td> <td><code>TBdQHu2hd5obmikZWn4KkuqmxaN1LCEp4U</code></td></tr> <tr><td>DICE-USD</td> <td><code>TYQh9z6g2aGB1mQwRzGvdFphkt1nEjAMY2</code></td></tr> <tr><td>USDJ-USD</td> <td><code>TBbg182ovR4Ra282MERwDwiyCVS2gtjF8g</code></td></tr> <tr><td>JST-TRX</td> <td><code>TCf4vSQLbHBFKzezHudEpvnhJ5GNQ6F2Ex</code></td></tr> <tr><td>WIN-TRX</td> <td><code>TR6LAm2T1kdqgZBYWBtyS9HXs11KhvK5cq</code></td></tr> <tr><td>DICE-TRX</td> <td><code>TLjFYyi7Va3nUfEgUiL5S1YgLqPYjv7aF4</code></td></tr> <tr><td>LIVE-USD</td> <td><code>TBpcwZo2Vk825nss6WSSdhVz7NWqt5aS1U</code></td></tr> <tr><td>USDT-USD</td> <td><code>TZ8u8sz1ToRfGaQ5JbYNwEiuRTXUBe9tFx</code></td></tr> <tr><td>SUNOLD-TRX</td> <td><code>TE14YrYpFtrPqxVSQ6V4WUsTniwfdcxbAR</code></td></tr> <tr><td>BTC-TRX</td> <td><code>TGNLjD435kXGoHi9JiFvrDr9SQE6eyu91X</code></td></tr> <tr><td>USDJ-TRX</td> <td><code>TDQA9eG9tmS7JbbFbzfcxvQn1Z9xuPt62V</code></td></tr> <tr><td>USDT-TRX</td> <td><code>TWBz6RPTbgEu9qY72NNRSZprD88DnHzizw</code></td></tr> <tr><td>BTT-USD</td> <td><code>THNCvWFdV3Qe2SeFWzz95XvjjsmBPtHi6q</code></td></tr> <tr><td>BTT-TRX</td> <td><code>TSEu2g6oD5ukHYvKbn2shc9mdpELySgbv9</code></td></tr> <tr><td>ETH-TRX</td> <td><code>TENtY6C9WiCpGenjUFwf33DYTcrV7GEZuh</code></td></tr></tbody></table> <h3 id="nile-测试网"><a href="#nile-测试网" class="header-anchor">#</a> Nile 测试网</h3> <ul><li>合约列表<a href="http://47.252.73.5:3300/#/solutions" target="_blank" rel="noopener noreferrer">查看页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>WIN 代币合约地址: <code>TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</code></li> <li>WinkMid 合约地址: <code>TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb</code></li></ul> <p>价格服务合约地址列表：</p> <table><thead><tr><th>Pair</th> <th>喂价合约地址</th> <th>Oracle 合约地址</th> <th>job id</th></tr></thead> <tbody><tr><td>TRX-USD</td> <td><code>TAL6RWymPLepKsLGCzWPUTKQQcWFsuHfNE</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code><br><code>TEx4rxit3Au6ek5avy4Aiy1N6Fyt38AS3o</code></td> <td><code>bb347a9a63324fd995a7159cb0c8348a</code><br><code>40691f5fd4b64ab4a5442477ed484d80</code><br><code>f7ccb652cc254a19b0b954c49af25926</code><br><code>38cd68072a6c4a0ca05e9b91976cf4f1</code><br><code>328697ef599043e1a301ae985d06aabf</code></td></tr> <tr><td>JST-USD</td> <td><code>TYr8nvS9BUbi9eLXNQpUMbxdvwYpoWn3ho</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>b09f188f336844e2b4f93ec7c2cc238f</code><br><code>ca97ef49175a44078c2c2933287915fd</code><br><code>1f26180c61824d25b822d76972f16d7d</code><br><code>c10608a577214eba904a7673d4e97fca</code></td></tr> <tr><td>SUNOLD-USD</td> <td><code>TWWjBHU3KkuV65rTVkA4UrCrGwBRTXs3KK</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>884366e5e9e441d6a792f77907778345</code><br><code>e109e9a1dc26475a834446509468ac59</code><br><code>d528c7c0d4784d0d9b53b932694b44fe</code><br><code>3f0a614654704ec3b50da1612b478ecb</code></td></tr> <tr><td>BTC-USD</td> <td><code>TYY5GdNvHN8NVY6MYtgEPwx15pyUmLEw5J</code></td> <td><code>TRDh1Hi4Hugb4J7DiQfvW6mCf8xGTEsQ66</code><br><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TQdYZe2XK2MwXx4PgDLuTWy4rhsc1A87wu</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code><br><code>TEx4rxit3Au6ek5avy4Aiy1N6Fyt38AS3o</code></td> <td><code>5a0f83ca61d74bad961acd0912adc53f</code><br><code>4f929a07ad1b4efba8fa686ad9641738</code><br><code>7c2457a191bf43488419adf7c48d4ff0</code><br><code>83d851c6627e4fed8c0e24292e1dc42f</code><br><code>1fc45a68c7f346229f08aee1982daa0e</code></td></tr> <tr><td>WIN-USD</td> <td><code>TGPDYFAcFx8ZXf7sGTLwbvsDh8FdEnsNyN</code></td> <td><code>TVKZGaPgSg8r3Pjyd5LsvbYEM5WRwfMetc</code><br><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>2f6c1f3dbb634e60910da542df34a94a</code><br><code>ca4821f3c5ef4b2cb8ee330a6f634520</code></td></tr> <tr><td>DICE-USD</td> <td><code>TS8fAMLNnbWgNyXz6queFHR7HfZkhAeppK</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>ad7888ed606d4b249edd298791f0c2d7</code></td></tr> <tr><td>USDJ-USDT</td> <td><code>TMmh7ZJkXpz4fE9FyFvRByMwvBE5Z2cRj8</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>b0ec07370a734d0cbdfabf6fe0e903c0</code></td></tr> <tr><td>JST-TRX</td> <td><code>THs9f15hC6r6rWzAE2NBUyiX2SetwDCnYD</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>4ac87bf722da4659ae9989c2ad7646ae</code></td></tr> <tr><td>WIN-TRX</td> <td><code>TReQocbkKBbGrgzoYWQ8bJnCNG1LGehwZw</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>febfcef0ce234fbdabaad191f2c4c542</code></td></tr> <tr><td>DICE-TRX</td> <td><code>TSejCUHkk5gD2UjtoPt3n3rdByTbKLac4Q</code></td> <td><code>TFKq9ZyySXFe1iCtWyYAFbJFCV9uEt5ghb</code></td> <td><code>c22e485bb31a4680b7eff3dc590d8c8f</code></td></tr></tbody></table> <h3 id="申请新交易对"><a href="#申请新交易对" class="header-anchor">#</a> 申请新交易对</h3> <p>如果您需要 WINkLink 提供新的交易对，请填写并提交<a href="https://docs.google.com/forms/d/e/1FAIpQLSdPqV3oWV87FYdox5D_J6BIve7R5eG0cHIGsh49r8gg_QiNeQ/viewform" target="_blank" rel="noopener noreferrer">申请表单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="部署价格服务"><a href="#部署价格服务" class="header-anchor">#</a> 部署价格服务</h2> <p>开发者也可以部署自己的价格服务，自定义价格来源和最少响应预言机个数。</p> <p>生产环境情况下，应该需要多个预言机节点来喂价，然后通过聚合得到一个最终的价格。
但在测试的流程下，我们暂且只设置一个节点来喂价。简化测试展示流程。</p> <h3 id="部署喂价合约"><a href="#部署喂价合约" class="header-anchor">#</a> 部署喂价合约</h3> <p>TronUser 合约是 WINkLink 官方推出的聚合价格服务合约模板，该合约实现了 <code>AggregatorInterface</code> 接口，开发者可以直接使用。</p> <p>合约代码位于 <a href="https://github.com/wink-link/winklink/blob/master/tvm-contracts/v1.0/TronUser.sol" target="_blank" rel="noopener noreferrer">TronUser.sol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>部署 TronUser 合约时需要在构造函数提供 WIN 代币地址和 WinkMid 合约地址。例如 Nile 测试网中，需要提供
<code>(TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2, TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb)</code>.</p> <h3 id="添加预言机节点以及-job-id"><a href="#添加预言机节点以及-job-id" class="header-anchor">#</a> 添加预言机节点以及 job ID</h3> <p>TronUser 合约部署完毕后，合约 owner 需要为其设置所聚合请求的预言机服务列表。使用如下接口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateRequestDetails</span><span class="token punctuation">(</span><span class="token parameter">uint128 _paymentAmount<span class="token punctuation">,</span> uint128 _minimumResponses<span class="token punctuation">,</span> address<span class="token punctuation">[</span><span class="token punctuation">]</span> _oracles<span class="token punctuation">,</span> bytes32<span class="token punctuation">[</span><span class="token punctuation">]</span> _jobIds</span><span class="token punctuation">)</span>
</code></pre></div><p>其中 <code>_paymentAmount</code> 表示每次更新调用所支付代币数量。</p> <p><code>_oracles</code> 和 <code>_jobIds</code> 是一对等长列表，每组对应一个 WINkLink 预言机 job 唯一标识。</p> <p><code>_minimumResponses</code> 表示需要的最少响应预言机个数，必须大于等于 <code>_oracles</code> 长度。
例如可以设置要求至少 5/10 个预言机响应后，本次更新值才有效。</p> <p>示例调用 <code>updateRequestDetails(10, 1, [&quot;TR9jYcLWAcQfbKcP5oau1ccSbeW7mdnqg8&quot;], [&quot;db22ccf4b4a14d0cae2a0757632e425d&quot;])</code>.</p> <h3 id="为合约转入-win-代币"><a href="#为合约转入-win-代币" class="header-anchor">#</a> 为合约转入 WIN 代币</h3> <p>TronUser 合约需要使用 <code>transferAndCall</code> 调用 Oracle 合约，所以合约账户需要有足够的 WIN 代币。
可以通过转账或测试网水龙头为合约转入若干 WIN 代币。</p> <h3 id="调用喂价合约"><a href="#调用喂价合约" class="header-anchor">#</a> 调用喂价合约</h3> <h4 id="更新价格-requestrateupdate"><a href="#更新价格-requestrateupdate" class="header-anchor">#</a> 更新价格 requestRateUpdate</h4> <p>使用如下接口请求 WINkLink 预言机节点从外部数据源获取最新价格：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">requestRateUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">returns</span> <span class="token punctuation">(</span>bytes32<span class="token punctuation">)</span>
</code></pre></div><p>接口返回 <code>requestID</code>. 通过 <code>requestID</code> 可以取消更新价格请求。</p> <h4 id="获取最新价格-latestanswer"><a href="#获取最新价格-latestanswer" class="header-anchor">#</a> 获取最新价格 latestAnswer</h4> <p>使用 <code>AggregatorInterface</code> 中的 <code>latestAnswer()</code> 调用可以获取最新价格。</p> <p>TronScan 的合约信息页面可以直接调用该方法获得最新值。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1/doc/deploy.html" class="prev">
        搭建 WINkLink 节点
      </a></span> <span class="next"><a href="/v1/doc/v2.html">
        v2 FluxAggregator
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v1/doc/assets/js/app.2c857601.js" defer></script><script src="/v1/doc/assets/js/2.f2b16297.js" defer></script><script src="/v1/doc/assets/js/19.b9b0cb89.js" defer></script>
  </body>
</html>
